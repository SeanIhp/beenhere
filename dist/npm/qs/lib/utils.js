"use strict";var exports=module.exports={};
var _keys = require('../../babel-runtime/core-js/object/keys.js');

var _keys2 = _interopRequireDefault(_keys);

var _typeof2 = require('../../babel-runtime/helpers/typeof.js');

var _typeof3 = _interopRequireDefault(_typeof2);

var _create = require('../../babel-runtime/core-js/object/create.js');

var _create2 = _interopRequireDefault(_create);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var has = Object.prototype.hasOwnProperty;

var hexTable = function () {
    var array = [];
    for (var i = 0; i < 256; ++i) {
        array.push('%' + ((i < 16 ? '0' : '') + i.toString(16)).toUpperCase());
    }

    return array;
}();

exports.arrayToObject = function (source, options) {
    var obj = options && options.plainObjects ? (0, _create2.default)(null) : {};
    for (var i = 0; i < source.length; ++i) {
        if (typeof source[i] !== 'undefined') {
            obj[i] = source[i];
        }
    }

    return obj;
};

exports.merge = function (target, source, options) {
    if (!source) {
        return target;
    }

    if ((typeof source === 'undefined' ? 'undefined' : (0, _typeof3.default)(source)) !== 'object') {
        if (Array.isArray(target)) {
            target.push(source);
        } else if ((typeof target === 'undefined' ? 'undefined' : (0, _typeof3.default)(target)) === 'object') {
            if (options.plainObjects || options.allowPrototypes || !has.call(Object.prototype, source)) {
                target[source] = true;
            }
        } else {
            return [target, source];
        }

        return target;
    }

    if ((typeof target === 'undefined' ? 'undefined' : (0, _typeof3.default)(target)) !== 'object') {
        return [target].concat(source);
    }

    var mergeTarget = target;
    if (Array.isArray(target) && !Array.isArray(source)) {
        mergeTarget = exports.arrayToObject(target, options);
    }

    if (Array.isArray(target) && Array.isArray(source)) {
        source.forEach(function (item, i) {
            if (has.call(target, i)) {
                if (target[i] && (0, _typeof3.default)(target[i]) === 'object') {
                    target[i] = exports.merge(target[i], item, options);
                } else {
                    target.push(item);
                }
            } else {
                target[i] = item;
            }
        });
        return target;
    }

    return (0, _keys2.default)(source).reduce(function (acc, key) {
        var value = source[key];

        if (has.call(acc, key)) {
            acc[key] = exports.merge(acc[key], value, options);
        } else {
            acc[key] = value;
        }
        return acc;
    }, mergeTarget);
};

exports.assign = function assignSingleSource(target, source) {
    return (0, _keys2.default)(source).reduce(function (acc, key) {
        acc[key] = source[key];
        return acc;
    }, target);
};

exports.decode = function (str) {
    try {
        return decodeURIComponent(str.replace(/\+/g, ' '));
    } catch (e) {
        return str;
    }
};

exports.encode = function (str) {
    // This code was originally written by Brian White (mscdex) for the io.js core querystring library.
    // It has been adapted here for stricter adherence to RFC 3986
    if (str.length === 0) {
        return str;
    }

    var string = typeof str === 'string' ? str : String(str);

    var out = '';
    for (var i = 0; i < string.length; ++i) {
        var c = string.charCodeAt(i);

        if (c === 0x2D // -
        || c === 0x2E // .
        || c === 0x5F // _
        || c === 0x7E // ~
        || c >= 0x30 && c <= 0x39 // 0-9
        || c >= 0x41 && c <= 0x5A // a-z
        || c >= 0x61 && c <= 0x7A // A-Z
        ) {
                out += string.charAt(i);
                continue;
            }

        if (c < 0x80) {
            out = out + hexTable[c];
            continue;
        }

        if (c < 0x800) {
            out = out + (hexTable[0xC0 | c >> 6] + hexTable[0x80 | c & 0x3F]);
            continue;
        }

        if (c < 0xD800 || c >= 0xE000) {
            out = out + (hexTable[0xE0 | c >> 12] + hexTable[0x80 | c >> 6 & 0x3F] + hexTable[0x80 | c & 0x3F]);
            continue;
        }

        i += 1;
        c = 0x10000 + ((c & 0x3FF) << 10 | string.charCodeAt(i) & 0x3FF);
        out += hexTable[0xF0 | c >> 18] + hexTable[0x80 | c >> 12 & 0x3F] + hexTable[0x80 | c >> 6 & 0x3F] + hexTable[0x80 | c & 0x3F];
    }

    return out;
};

exports.compact = function (obj, references) {
    if ((typeof obj === 'undefined' ? 'undefined' : (0, _typeof3.default)(obj)) !== 'object' || obj === null) {
        return obj;
    }

    var refs = references || [];
    var lookup = refs.indexOf(obj);
    if (lookup !== -1) {
        return refs[lookup];
    }

    refs.push(obj);

    if (Array.isArray(obj)) {
        var compacted = [];

        for (var i = 0; i < obj.length; ++i) {
            if (obj[i] && (0, _typeof3.default)(obj[i]) === 'object') {
                compacted.push(exports.compact(obj[i], refs));
            } else if (typeof obj[i] !== 'undefined') {
                compacted.push(obj[i]);
            }
        }

        return compacted;
    }

    var keys = (0, _keys2.default)(obj);
    keys.forEach(function (key) {
        obj[key] = exports.compact(obj[key], refs);
    });

    return obj;
};

exports.isRegExp = function (obj) {
    return Object.prototype.toString.call(obj) === '[object RegExp]';
};

exports.isBuffer = function (obj) {
    if (obj === null || typeof obj === 'undefined') {
        return false;
    }

    return !!(obj.constructor && obj.constructor.isBuffer && obj.constructor.isBuffer(obj));
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIl0sIm5hbWVzIjpbImhhcyIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiaGV4VGFibGUiLCJhcnJheSIsImkiLCJwdXNoIiwidG9TdHJpbmciLCJ0b1VwcGVyQ2FzZSIsImV4cG9ydHMiLCJhcnJheVRvT2JqZWN0Iiwic291cmNlIiwib3B0aW9ucyIsIm9iaiIsInBsYWluT2JqZWN0cyIsImxlbmd0aCIsIm1lcmdlIiwidGFyZ2V0IiwiQXJyYXkiLCJpc0FycmF5IiwiYWxsb3dQcm90b3R5cGVzIiwiY2FsbCIsImNvbmNhdCIsIm1lcmdlVGFyZ2V0IiwiZm9yRWFjaCIsIml0ZW0iLCJyZWR1Y2UiLCJhY2MiLCJrZXkiLCJ2YWx1ZSIsImFzc2lnbiIsImFzc2lnblNpbmdsZVNvdXJjZSIsImRlY29kZSIsInN0ciIsImRlY29kZVVSSUNvbXBvbmVudCIsInJlcGxhY2UiLCJlIiwiZW5jb2RlIiwic3RyaW5nIiwiU3RyaW5nIiwib3V0IiwiYyIsImNoYXJDb2RlQXQiLCJjaGFyQXQiLCJjb21wYWN0IiwicmVmZXJlbmNlcyIsInJlZnMiLCJsb29rdXAiLCJpbmRleE9mIiwiY29tcGFjdGVkIiwia2V5cyIsImlzUmVnRXhwIiwiaXNCdWZmZXIiLCJjb25zdHJ1Y3RvciJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUFJQSxNQUFNQyxPQUFPQyxTQUFQLENBQWlCQyxjQUEzQjs7QUFFQSxJQUFJQyxXQUFZLFlBQVk7QUFDeEIsUUFBSUMsUUFBUSxFQUFaO0FBQ0EsU0FBSyxJQUFJQyxJQUFJLENBQWIsRUFBZ0JBLElBQUksR0FBcEIsRUFBeUIsRUFBRUEsQ0FBM0IsRUFBOEI7QUFDMUJELGNBQU1FLElBQU4sQ0FBVyxNQUFNLENBQUMsQ0FBQ0QsSUFBSSxFQUFKLEdBQVMsR0FBVCxHQUFlLEVBQWhCLElBQXNCQSxFQUFFRSxRQUFGLENBQVcsRUFBWCxDQUF2QixFQUF1Q0MsV0FBdkMsRUFBakI7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UDtBQUNIOztBQUVELFFBQUlDLE9BQU8sb0JBQVlyQyxHQUFaLENBQVg7QUFDQXFDLFNBQUsxQixPQUFMLENBQWEsVUFBVUksR0FBVixFQUFlO0FBQ3hCZixZQUFJZSxHQUFKLElBQVduQixRQUFRbUMsT0FBUixDQUFnQi9CLElBQUllLEdBQUosQ0FBaEIsRUFBMEJrQixJQUExQixDQUFYO0FBQ0gsS0FGRDs7QUFJQSxXQUFPakMsR0FBUDtBQUNILENBakNEOztBQW1DQUosUUFBUTBDLFFBQVIsR0FBbUIsVUFBVXRDLEdBQVYsRUFBZTtBQUM5QixXQUFPYixPQUFPQyxTQUFQLENBQWlCTSxRQUFqQixDQUEwQmMsSUFBMUIsQ0FBK0JSLEdBQS9CLE1BQXdDLGlCQUEvQztBQUNILENBRkQ7O0FBSUFKLFFBQVEyQyxRQUFSLEdBQW1CLFVBQVV2QyxHQUFWLEVBQWU7QUFDOUIsUUFBSUEsUUFBUSxJQUFSLElBQWdCLE9BQU9BLEdBQVAsS0FBZSxXQUFuQyxFQUFnRDtBQUM1QyxlQUFPLEtBQVA7QUFDSDs7QUFFRCxXQUFPLENBQUMsRUFBRUEsSUFBSXdDLFdBQUosSUFBbUJ4QyxJQUFJd0MsV0FBSixDQUFnQkQsUUFBbkMsSUFBK0N2QyxJQUFJd0MsV0FBSixDQUFnQkQsUUFBaEIsQ0FBeUJ2QyxHQUF6QixDQUFqRCxDQUFSO0FBQ0gsQ0FORCIsImZpbGUiOiJ1bmtub3duIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgaGFzID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtcblxudmFyIGhleFRhYmxlID0gKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYXJyYXkgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgKytpKSB7XG4gICAgICAgIGFycmF5LnB1c2goJyUnICsgKChpIDwgMTYgPyAnMCcgOiAnJykgKyBpLnRvU3RyaW5nKDE2KSkudG9VcHBlckNhc2UoKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFycmF5O1xufSgpKTtcblxuZXhwb3J0cy5hcnJheVRvT2JqZWN0ID0gZnVuY3Rpb24gKHNvdXJjZSwgb3B0aW9ucykge1xuICAgIHZhciBvYmogPSBvcHRpb25zICYmIG9wdGlvbnMucGxhaW5PYmplY3RzID8gT2JqZWN0LmNyZWF0ZShudWxsKSA6IHt9O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc291cmNlLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygc291cmNlW2ldICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgb2JqW2ldID0gc291cmNlW2ldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG9iajtcbn07XG5cbmV4cG9ydHMubWVyZ2UgPSBmdW5jdGlvbiAodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpIHtcbiAgICBpZiAoIXNvdXJjZSkge1xuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgIH1cblxuICAgIGlmICh0eXBlb2Ygc291cmNlICE9PSAnb2JqZWN0Jykge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpKSB7XG4gICAgICAgICAgICB0YXJnZXQucHVzaChzb3VyY2UpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0YXJnZXQgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5wbGFpbk9iamVjdHMgfHwgb3B0aW9ucy5hbGxvd1Byb3RvdHlwZXMgfHwgIWhhcy5jYWxsKE9iamVjdC5wcm90b3R5cGUsIHNvdXJjZSkpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRbc291cmNlXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gW3RhcmdldCwgc291cmNlXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB0YXJnZXQgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJldHVybiBbdGFyZ2V0XS5jb25jYXQoc291cmNlKTtcbiAgICB9XG5cbiAgICB2YXIgbWVyZ2VUYXJnZXQgPSB0YXJnZXQ7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodGFyZ2V0KSAmJiAhQXJyYXkuaXNBcnJheShzb3VyY2UpKSB7XG4gICAgICAgIG1lcmdlVGFyZ2V0ID0gZXhwb3J0cy5hcnJheVRvT2JqZWN0KHRhcmdldCwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodGFyZ2V0KSAmJiBBcnJheS5pc0FycmF5KHNvdXJjZSkpIHtcbiAgICAgICAgc291cmNlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGkpIHtcbiAgICAgICAgICAgIGlmIChoYXMuY2FsbCh0YXJnZXQsIGkpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldFtpXSAmJiB0eXBlb2YgdGFyZ2V0W2ldID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRbaV0gPSBleHBvcnRzLm1lcmdlKHRhcmdldFtpXSwgaXRlbSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRbaV0gPSBpdGVtO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9XG5cbiAgICByZXR1cm4gT2JqZWN0LmtleXMoc291cmNlKS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywga2V5KSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHNvdXJjZVtrZXldO1xuXG4gICAgICAgIGlmIChoYXMuY2FsbChhY2MsIGtleSkpIHtcbiAgICAgICAgICAgIGFjY1trZXldID0gZXhwb3J0cy5tZXJnZShhY2Nba2V5XSwgdmFsdWUsIG9wdGlvbnMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYWNjW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWNjO1xuICAgIH0sIG1lcmdlVGFyZ2V0KTtcbn07XG5cbmV4cG9ydHMuYXNzaWduID0gZnVuY3Rpb24gYXNzaWduU2luZ2xlU291cmNlKHRhcmdldCwgc291cmNlKSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHNvdXJjZSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGtleSkge1xuICAgICAgICBhY2Nba2V5XSA9IHNvdXJjZVtrZXldO1xuICAgICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHRhcmdldCk7XG59O1xuXG5leHBvcnRzLmRlY29kZSA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHN0ci5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gc3RyO1xuICAgIH1cbn07XG5cbmV4cG9ydHMuZW5jb2RlID0gZnVuY3Rpb24gKHN0cikge1xuICAgIC8vIFRoaXMgY29kZSB3YXMgb3JpZ2luYWxseSB3cml0dGVuIGJ5IEJyaWFuIFdoaXRlIChtc2NkZXgpIGZvciB0aGUgaW8uanMgY29yZSBxdWVyeXN0cmluZyBsaWJyYXJ5LlxuICAgIC8vIEl0IGhhcyBiZWVuIGFkYXB0ZWQgaGVyZSBmb3Igc3RyaWN0ZXIgYWRoZXJlbmNlIHRvIFJGQyAzOTg2XG4gICAgaWYgKHN0ci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHN0cjtcbiAgICB9XG5cbiAgICB2YXIgc3RyaW5nID0gdHlwZW9mIHN0ciA9PT0gJ3N0cmluZycgPyBzdHIgOiBTdHJpbmcoc3RyKTtcblxuICAgIHZhciBvdXQgPSAnJztcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0cmluZy5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgYyA9IHN0cmluZy5jaGFyQ29kZUF0KGkpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIGMgPT09IDB4MkQgICAgLy8gLVxuICAgICAgICAgICAgfHwgYyA9PT0gMHgyRSAvLyAuXG4gICAgICAgICAgICB8fCBjID09PSAweDVGIC8vIF9cbiAgICAgICAgICAgIHx8IGMgPT09IDB4N0UgLy8gflxuICAgICAgICAgICAgfHwgKGMgPj0gMHgzMCAmJiBjIDw9IDB4MzkpIC8vIDAtOVxuICAgICAgICAgICAgfHwgKGMgPj0gMHg0MSAmJiBjIDw9IDB4NUEpIC8vIGEtelxuICAgICAgICAgICAgfHwgKGMgPj0gMHg2MSAmJiBjIDw9IDB4N0EpIC8vIEEtWlxuICAgICAgICApIHtcbiAgICAgICAgICAgIG91dCArPSBzdHJpbmcuY2hhckF0KGkpO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYyA8IDB4ODApIHtcbiAgICAgICAgICAgIG91dCA9IG91dCArIGhleFRhYmxlW2NdO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYyA8IDB4ODAwKSB7XG4gICAgICAgICAgICBvdXQgPSBvdXQgKyAoaGV4VGFibGVbMHhDMCB8IChjID4+IDYpXSArIGhleFRhYmxlWzB4ODAgfCAoYyAmIDB4M0YpXSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjIDwgMHhEODAwIHx8IGMgPj0gMHhFMDAwKSB7XG4gICAgICAgICAgICBvdXQgPSBvdXQgKyAoaGV4VGFibGVbMHhFMCB8IChjID4+IDEyKV0gKyBoZXhUYWJsZVsweDgwIHwgKChjID4+IDYpICYgMHgzRildICsgaGV4VGFibGVbMHg4MCB8IChjICYgMHgzRildKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaSArPSAxO1xuICAgICAgICBjID0gMHgxMDAwMCArICgoKGMgJiAweDNGRikgPDwgMTApIHwgKHN0cmluZy5jaGFyQ29kZUF0KGkpICYgMHgzRkYpKTtcbiAgICAgICAgb3V0ICs9IGhleFRhYmxlWzB4RjAgfCAoYyA+PiAxOCldXG4gICAgICAgICAgICArIGhleFRhYmxlWzB4ODAgfCAoKGMgPj4gMTIpICYgMHgzRildXG4gICAgICAgICAgICArIGhleFRhYmxlWzB4ODAgfCAoKGMgPj4gNikgJiAweDNGKV1cbiAgICAgICAgICAgICsgaGV4VGFibGVbMHg4MCB8IChjICYgMHgzRildO1xuICAgIH1cblxuICAgIHJldHVybiBvdXQ7XG59O1xuXG5leHBvcnRzLmNvbXBhY3QgPSBmdW5jdGlvbiAob2JqLCByZWZlcmVuY2VzKSB7XG4gICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cblxuICAgIHZhciByZWZzID0gcmVmZXJlbmNlcyB8fCBbXTtcbiAgICB2YXIgbG9va3VwID0gcmVmcy5pbmRleE9mKG9iaik7XG4gICAgaWYgKGxvb2t1cCAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIHJlZnNbbG9va3VwXTtcbiAgICB9XG5cbiAgICByZWZzLnB1c2gob2JqKTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcbiAgICAgICAgdmFyIGNvbXBhY3RlZCA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAob2JqW2ldICYmIHR5cGVvZiBvYmpbaV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgY29tcGFjdGVkLnB1c2goZXhwb3J0cy5jb21wYWN0KG9ialtpXSwgcmVmcykpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqW2ldICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGNvbXBhY3RlZC5wdXNoKG9ialtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29tcGFjdGVkO1xuICAgIH1cblxuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTtcbiAgICBrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBvYmpba2V5XSA9IGV4cG9ydHMuY29tcGFjdChvYmpba2V5XSwgcmVmcyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gb2JqO1xufTtcblxuZXhwb3J0cy5pc1JlZ0V4cCA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IFJlZ0V4cF0nO1xufTtcblxuZXhwb3J0cy5pc0J1ZmZlciA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICBpZiAob2JqID09PSBudWxsIHx8IHR5cGVvZiBvYmogPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gISEob2JqLmNvbnN0cnVjdG9yICYmIG9iai5jb25zdHJ1Y3Rvci5pc0J1ZmZlciAmJiBvYmouY29uc3RydWN0b3IuaXNCdWZmZXIob2JqKSk7XG59O1xuIl19