"use strict";var exports=module.exports={};
var _keys = require('../../babel-runtime/core-js/object/keys.js');

var _keys2 = _interopRequireDefault(_keys);

var _typeof2 = require('../../babel-runtime/helpers/typeof.js');

var _typeof3 = _interopRequireDefault(_typeof2);

var _create = require('../../babel-runtime/core-js/object/create.js');

var _create2 = _interopRequireDefault(_create);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var has = Object.prototype.hasOwnProperty;

var hexTable = function () {
    var array = [];
    for (var i = 0; i < 256; ++i) {
        array.push('%' + ((i < 16 ? '0' : '') + i.toString(16)).toUpperCase());
    }

    return array;
}();

exports.arrayToObject = function (source, options) {
    var obj = options && options.plainObjects ? (0, _create2.default)(null) : {};
    for (var i = 0; i < source.length; ++i) {
        if (typeof source[i] !== 'undefined') {
            obj[i] = source[i];
        }
    }

    return obj;
};

exports.merge = function (target, source, options) {
    if (!source) {
        return target;
    }

    if ((typeof source === 'undefined' ? 'undefined' : (0, _typeof3.default)(source)) !== 'object') {
        if (Array.isArray(target)) {
            target.push(source);
        } else if ((typeof target === 'undefined' ? 'undefined' : (0, _typeof3.default)(target)) === 'object') {
            if (options.plainObjects || options.allowPrototypes || !has.call(Object.prototype, source)) {
                target[source] = true;
            }
        } else {
            return [target, source];
        }

        return target;
    }

    if ((typeof target === 'undefined' ? 'undefined' : (0, _typeof3.default)(target)) !== 'object') {
        return [target].concat(source);
    }

    var mergeTarget = target;
    if (Array.isArray(target) && !Array.isArray(source)) {
        mergeTarget = exports.arrayToObject(target, options);
    }

    if (Array.isArray(target) && Array.isArray(source)) {
        source.forEach(function (item, i) {
            if (has.call(target, i)) {
                if (target[i] && (0, _typeof3.default)(target[i]) === 'object') {
                    target[i] = exports.merge(target[i], item, options);
                } else {
                    target.push(item);
                }
            } else {
                target[i] = item;
            }
        });
        return target;
    }

    return (0, _keys2.default)(source).reduce(function (acc, key) {
        var value = source[key];

        if (Object.prototype.hasOwnProperty.call(acc, key)) {
            acc[key] = exports.merge(acc[key], value, options);
        } else {
            acc[key] = value;
        }
        return acc;
    }, mergeTarget);
};

exports.decode = function (str) {
    try {
        return decodeURIComponent(str.replace(/\+/g, ' '));
    } catch (e) {
        return str;
    }
};

exports.encode = function (str) {
    // This code was originally written by Brian White (mscdex) for the io.js core querystring library.
    // It has been adapted here for stricter adherence to RFC 3986
    if (str.length === 0) {
        return str;
    }

    var string = typeof str === 'string' ? str : String(str);

    var out = '';
    for (var i = 0; i < string.length; ++i) {
        var c = string.charCodeAt(i);

        if (c === 0x2D || // -
        c === 0x2E || // .
        c === 0x5F || // _
        c === 0x7E || // ~
        c >= 0x30 && c <= 0x39 || // 0-9
        c >= 0x41 && c <= 0x5A || // a-z
        c >= 0x61 && c <= 0x7A // A-Z
        ) {
                out += string.charAt(i);
                continue;
            }

        if (c < 0x80) {
            out = out + hexTable[c];
            continue;
        }

        if (c < 0x800) {
            out = out + (hexTable[0xC0 | c >> 6] + hexTable[0x80 | c & 0x3F]);
            continue;
        }

        if (c < 0xD800 || c >= 0xE000) {
            out = out + (hexTable[0xE0 | c >> 12] + hexTable[0x80 | c >> 6 & 0x3F] + hexTable[0x80 | c & 0x3F]);
            continue;
        }

        i += 1;
        c = 0x10000 + ((c & 0x3FF) << 10 | string.charCodeAt(i) & 0x3FF);
        out += hexTable[0xF0 | c >> 18] + hexTable[0x80 | c >> 12 & 0x3F] + hexTable[0x80 | c >> 6 & 0x3F] + hexTable[0x80 | c & 0x3F]; // eslint-disable-line max-len
    }

    return out;
};

exports.compact = function (obj, references) {
    if ((typeof obj === 'undefined' ? 'undefined' : (0, _typeof3.default)(obj)) !== 'object' || obj === null) {
        return obj;
    }

    var refs = references || [];
    var lookup = refs.indexOf(obj);
    if (lookup !== -1) {
        return refs[lookup];
    }

    refs.push(obj);

    if (Array.isArray(obj)) {
        var compacted = [];

        for (var i = 0; i < obj.length; ++i) {
            if (obj[i] && (0, _typeof3.default)(obj[i]) === 'object') {
                compacted.push(exports.compact(obj[i], refs));
            } else if (typeof obj[i] !== 'undefined') {
                compacted.push(obj[i]);
            }
        }

        return compacted;
    }

    var keys = (0, _keys2.default)(obj);
    keys.forEach(function (key) {
        obj[key] = exports.compact(obj[key], refs);
    });

    return obj;
};

exports.isRegExp = function (obj) {
    return Object.prototype.toString.call(obj) === '[object RegExp]';
};

exports.isBuffer = function (obj) {
    if (obj === null || typeof obj === 'undefined') {
        return false;
    }

    return !!(obj.constructor && obj.constructor.isBuffer && obj.constructor.isBuffer(obj));
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIl0sIm5hbWVzIjpbImhhcyIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiaGV4VGFibGUiLCJhcnJheSIsImkiLCJwdXNoIiwidG9TdHJpbmciLCJ0b1VwcGVyQ2FzZSIsImV4cG9ydHMiLCJhcnJheVRvT2JqZWN0Iiwic291cmNlIiwib3B0aW9ucyIsIm9iaiIsInBsYWluT2JqZWN0cyIsImxlbmd0aCIsIm1lcmdlIiwidGFyZ2V0IiwiQXJyYXkiLCJpc0FycmF5IiwiYWxsb3dQcm90b3R5cGVzIiwiY2FsbCIsImNvbmNhdCIsIm1lcmdlVGFyZ2V0IiwiZm9yRWFjaCIsIml0ZW0iLCJyZWR1Y2UiLCJhY2MiLCJrZXkiLCJ2YWx1ZSIsImRlY29kZSIsInN0ciIsImRlY29kZVVSSUNvbXBvbmVudCIsInJlcGxhY2UiLCJlIiwiZW5jb2RlIiwic3RyaW5nIiwiU3RyaW5nIiwib3V0IiwiYyIsImNoYXJDb2RlQXQiLCJjaGFyQXQiLCJjb21wYWN0IiwicmVmZXJlbmNlcyIsInJlZnMiLCJsb29rdXAiLCJpbmRleE9mIiwiY29tcGFjdGVkIiwia2V5cyIsImlzUmVnRXhwIiwiaXNCdWZmZXIiLCJjb25zdHJ1Y3RvciJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUFJQSxNQUFNQyxPQUFPQyxTQUFQLENBQWlCQyxjQUEzQjs7QUFFQSxJQUFJQyxXQUFZLFlBQVk7QUFDeEIsUUFBSUMsUUFBUSxFQUFaO0FBQ0EsU0FBSyxJQUFJQyxJQUFJLENBQWIsRUFBZ0JBLElBQUksR0FBcEIsRUFBeUIsRUFBRUEsQ0FBM0IsRUFBOEI7QUFDMUJELGNBQU1FLElBQU4sQ0FBVyxNQUFNLENBQUMsQ0FBQ0QsSUFBSSxFQUFKLEdBQVMsR0FBVCxHQUFlLEVBQWhCLElBQXNCQSxFQUFFRSxRQUFGLENBQVcsRUFBWCxDQUF2QixFQUF1Q0MsV0FBdkMsRUFBakI7QUFDSDs7QUFFRCxXQUFPSixLQUFQO0FBQ0gsQ0FQ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QWU7QUFDOUIsV0FBT2IsT0FBT0MsU0FBUCxDQUFpQk0sUUFBakIsQ0FBMEJjLElBQTFCLENBQStCUixHQUEvQixNQUF3QyxpQkFBL0M7QUFDSCxDQUZEOztBQUlBSixRQUFReUMsUUFBUixHQUFtQixVQUFVckMsR0FBVixFQUFlO0FBQzlCLFFBQUlBLFFBQVEsSUFBUixJQUFnQixPQUFPQSxHQUFQLEtBQWUsV0FBbkMsRUFBZ0Q7QUFDNUMsZUFBTyxLQUFQO0FBQ0g7O0FBRUQsV0FBTyxDQUFDLEVBQUVBLElBQUlzQyxXQUFKLElBQW1CdEMsSUFBSXNDLFdBQUosQ0FBZ0JELFFBQW5DLElBQStDckMsSUFBSXNDLFdBQUosQ0FBZ0JELFFBQWhCLENBQXlCckMsR0FBekIsQ0FBakQsQ0FBUjtBQUNILENBTkQiLCJmaWxlIjoidW5rbm93biIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGhhcyA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG5cbnZhciBoZXhUYWJsZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGFycmF5ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7ICsraSkge1xuICAgICAgICBhcnJheS5wdXNoKCclJyArICgoaSA8IDE2ID8gJzAnIDogJycpICsgaS50b1N0cmluZygxNikpLnRvVXBwZXJDYXNlKCkpO1xuICAgIH1cblxuICAgIHJldHVybiBhcnJheTtcbn0oKSk7XG5cbmV4cG9ydHMuYXJyYXlUb09iamVjdCA9IGZ1bmN0aW9uIChzb3VyY2UsIG9wdGlvbnMpIHtcbiAgICB2YXIgb2JqID0gb3B0aW9ucyAmJiBvcHRpb25zLnBsYWluT2JqZWN0cyA/IE9iamVjdC5jcmVhdGUobnVsbCkgOiB7fTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvdXJjZS5sZW5ndGg7ICsraSkge1xuICAgICAgICBpZiAodHlwZW9mIHNvdXJjZVtpXSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIG9ialtpXSA9IHNvdXJjZVtpXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBvYmo7XG59O1xuXG5leHBvcnRzLm1lcmdlID0gZnVuY3Rpb24gKHRhcmdldCwgc291cmNlLCBvcHRpb25zKSB7XG4gICAgaWYgKCFzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHNvdXJjZSAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGFyZ2V0KSkge1xuICAgICAgICAgICAgdGFyZ2V0LnB1c2goc291cmNlKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGFyZ2V0ID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMucGxhaW5PYmplY3RzIHx8IG9wdGlvbnMuYWxsb3dQcm90b3R5cGVzIHx8ICFoYXMuY2FsbChPYmplY3QucHJvdG90eXBlLCBzb3VyY2UpKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0W3NvdXJjZV0gPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFt0YXJnZXQsIHNvdXJjZV07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdGFyZ2V0ICE9PSAnb2JqZWN0Jykge1xuICAgICAgICByZXR1cm4gW3RhcmdldF0uY29uY2F0KHNvdXJjZSk7XG4gICAgfVxuXG4gICAgdmFyIG1lcmdlVGFyZ2V0ID0gdGFyZ2V0O1xuICAgIGlmIChBcnJheS5pc0FycmF5KHRhcmdldCkgJiYgIUFycmF5LmlzQXJyYXkoc291cmNlKSkge1xuICAgICAgICBtZXJnZVRhcmdldCA9IGV4cG9ydHMuYXJyYXlUb09iamVjdCh0YXJnZXQsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIGlmIChBcnJheS5pc0FycmF5KHRhcmdldCkgJiYgQXJyYXkuaXNBcnJheShzb3VyY2UpKSB7XG4gICAgICAgIHNvdXJjZS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpKSB7XG4gICAgICAgICAgICBpZiAoaGFzLmNhbGwodGFyZ2V0LCBpKSkge1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRbaV0gJiYgdHlwZW9mIHRhcmdldFtpXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2ldID0gZXhwb3J0cy5tZXJnZSh0YXJnZXRbaV0sIGl0ZW0sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0W2ldID0gaXRlbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHNvdXJjZSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGtleSkge1xuICAgICAgICB2YXIgdmFsdWUgPSBzb3VyY2Vba2V5XTtcblxuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGFjYywga2V5KSkge1xuICAgICAgICAgICAgYWNjW2tleV0gPSBleHBvcnRzLm1lcmdlKGFjY1trZXldLCB2YWx1ZSwgb3B0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhY2Nba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgbWVyZ2VUYXJnZXQpO1xufTtcblxuZXhwb3J0cy5kZWNvZGUgPSBmdW5jdGlvbiAoc3RyKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzdHIucmVwbGFjZSgvXFwrL2csICcgJykpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIHN0cjtcbiAgICB9XG59O1xuXG5leHBvcnRzLmVuY29kZSA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgICAvLyBUaGlzIGNvZGUgd2FzIG9yaWdpbmFsbHkgd3JpdHRlbiBieSBCcmlhbiBXaGl0ZSAobXNjZGV4KSBmb3IgdGhlIGlvLmpzIGNvcmUgcXVlcnlzdHJpbmcgbGlicmFyeS5cbiAgICAvLyBJdCBoYXMgYmVlbiBhZGFwdGVkIGhlcmUgZm9yIHN0cmljdGVyIGFkaGVyZW5jZSB0byBSRkMgMzk4NlxuICAgIGlmIChzdHIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuXG4gICAgdmFyIHN0cmluZyA9IHR5cGVvZiBzdHIgPT09ICdzdHJpbmcnID8gc3RyIDogU3RyaW5nKHN0cik7XG5cbiAgICB2YXIgb3V0ID0gJyc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHJpbmcubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGMgPSBzdHJpbmcuY2hhckNvZGVBdChpKTtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgICBjID09PSAweDJEIHx8IC8vIC1cbiAgICAgICAgICAgIGMgPT09IDB4MkUgfHwgLy8gLlxuICAgICAgICAgICAgYyA9PT0gMHg1RiB8fCAvLyBfXG4gICAgICAgICAgICBjID09PSAweDdFIHx8IC8vIH5cbiAgICAgICAgICAgIChjID49IDB4MzAgJiYgYyA8PSAweDM5KSB8fCAvLyAwLTlcbiAgICAgICAgICAgIChjID49IDB4NDEgJiYgYyA8PSAweDVBKSB8fCAvLyBhLXpcbiAgICAgICAgICAgIChjID49IDB4NjEgJiYgYyA8PSAweDdBKSAvLyBBLVpcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBvdXQgKz0gc3RyaW5nLmNoYXJBdChpKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGMgPCAweDgwKSB7XG4gICAgICAgICAgICBvdXQgPSBvdXQgKyBoZXhUYWJsZVtjXTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGMgPCAweDgwMCkge1xuICAgICAgICAgICAgb3V0ID0gb3V0ICsgKGhleFRhYmxlWzB4QzAgfCAoYyA+PiA2KV0gKyBoZXhUYWJsZVsweDgwIHwgKGMgJiAweDNGKV0pO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYyA8IDB4RDgwMCB8fCBjID49IDB4RTAwMCkge1xuICAgICAgICAgICAgb3V0ID0gb3V0ICsgKGhleFRhYmxlWzB4RTAgfCAoYyA+PiAxMildICsgaGV4VGFibGVbMHg4MCB8ICgoYyA+PiA2KSAmIDB4M0YpXSArIGhleFRhYmxlWzB4ODAgfCAoYyAmIDB4M0YpXSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGkgKz0gMTtcbiAgICAgICAgYyA9IDB4MTAwMDAgKyAoKChjICYgMHgzRkYpIDw8IDEwKSB8IChzdHJpbmcuY2hhckNvZGVBdChpKSAmIDB4M0ZGKSk7XG4gICAgICAgIG91dCArPSBoZXhUYWJsZVsweEYwIHwgKGMgPj4gMTgpXSArIGhleFRhYmxlWzB4ODAgfCAoKGMgPj4gMTIpICYgMHgzRildICsgaGV4VGFibGVbMHg4MCB8ICgoYyA+PiA2KSAmIDB4M0YpXSArIGhleFRhYmxlWzB4ODAgfCAoYyAmIDB4M0YpXTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBtYXgtbGVuXG4gICAgfVxuXG4gICAgcmV0dXJuIG91dDtcbn07XG5cbmV4cG9ydHMuY29tcGFjdCA9IGZ1bmN0aW9uIChvYmosIHJlZmVyZW5jZXMpIHtcbiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgfVxuXG4gICAgdmFyIHJlZnMgPSByZWZlcmVuY2VzIHx8IFtdO1xuICAgIHZhciBsb29rdXAgPSByZWZzLmluZGV4T2Yob2JqKTtcbiAgICBpZiAobG9va3VwICE9PSAtMSkge1xuICAgICAgICByZXR1cm4gcmVmc1tsb29rdXBdO1xuICAgIH1cblxuICAgIHJlZnMucHVzaChvYmopO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuICAgICAgICB2YXIgY29tcGFjdGVkID0gW107XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGlmIChvYmpbaV0gJiYgdHlwZW9mIG9ialtpXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICBjb21wYWN0ZWQucHVzaChleHBvcnRzLmNvbXBhY3Qob2JqW2ldLCByZWZzKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmpbaV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgY29tcGFjdGVkLnB1c2gob2JqW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb21wYWN0ZWQ7XG4gICAgfVxuXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmopO1xuICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIG9ialtrZXldID0gZXhwb3J0cy5jb21wYWN0KG9ialtrZXldLCByZWZzKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBvYmo7XG59O1xuXG5leHBvcnRzLmlzUmVnRXhwID0gZnVuY3Rpb24gKG9iaikge1xuICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgUmVnRXhwXSc7XG59O1xuXG5leHBvcnRzLmlzQnVmZmVyID0gZnVuY3Rpb24gKG9iaikge1xuICAgIGlmIChvYmogPT09IG51bGwgfHwgdHlwZW9mIG9iaiA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiAhIShvYmouY29uc3RydWN0b3IgJiYgb2JqLmNvbnN0cnVjdG9yLmlzQnVmZmVyICYmIG9iai5jb25zdHJ1Y3Rvci5pc0J1ZmZlcihvYmopKTtcbn07XG4iXX0=